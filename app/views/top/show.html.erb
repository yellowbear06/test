<div id="gmap" style="height:400px;width:600px"></div> <!-- 地図を表示する領域 -->
  <%= @name %>
  <p id="address"><%= @address %></p>
  <%= @place_data %>
  <%= @website %>
  <%= @opening_hours %>
  <%= @categories %>
  <%= @place.name %>
  <% @photos.each do |photo| %>
    <% photo_url = "https://maps.googleapis.com/maps/api/place/photo?photoreference=#{photo['photo_reference']}&sensor=false&maxheight=400&maxwidth=600&key=#{ENV['GOOGLE_MAPS_API_KEY']}" %>
    <%= image_tag(photo_url) %>
  <% end %>
  
<script>
function initMap() {
  var target = document.getElementById('gmap');  
  var address = document.getElementById('address').textContent; 
  var geocoder = new google.maps.Geocoder();  
  
  geocoder.geocode({ address: address }, function(results, status){
     if (status === 'OK' && results[0]){  
       //マップのインスタンスを変数に代入
        var map = new google.maps.Map(target, {  
          center: results[0].geometry.location,
          zoom: 14
        });
        console.log(results[0]);
       //マーカーの生成
        var marker = new google.maps.Marker({
          position: results[0].geometry.location,
          map: map,
          animation: google.maps.Animation.DROP
        });
       
       //情報ウィンドウの生成
        var contentString =
          '<div>' +
            '<h2>' + gon.place['name'] + '</h2>' +
            '<p>営業時間: ' + gon.place['opening_hours']['weekday_text'] + '</p>' +
            '<p>住所 ' + results[0]['formatted_address'] + '</p>' +
            '<p>評価 ' + gon.place['rating'] + '</p>' +
            '<p>カテゴリー ' + gon.place['types'][0] + '</p>' +
            '<p>電話番号 ' + gon.place['formatted_phone_number'] + '</p>' +
            '<a href="' + gon.place['website'] + '">' + gon.place['website'] + '</a>'
            '<img src="' + gon.place['icon'] + '" alt="icon">' +
          '</div>';

        var infoWindow = new google.maps.InfoWindow({
          content: contentString,
          pixelOffset: new google.maps.Size(0, 5)
        });
 
       //マーカーにリスナーを設定
       marker.addListener('click', function(){
          infoWindow.open(map, marker);
        });
       
     }else{ 
       alert('失敗しました。理由: ' + status);
       return;
     }
  });
}
</script> 
<script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAPS_API_KEY'] %>&libraries=places&callback=initMap" async defer></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
